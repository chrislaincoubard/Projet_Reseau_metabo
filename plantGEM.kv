#:import sys os
<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser
            dirselect : True
            path : sys.path.expanduser('~')

        BoxLayout:
            size_hint_y: None
            height : 70
            Button:
                text: "Cancel"
                size_hint_y : 0.5
                background_color:"#F00020"
                on_release: root.cancel()

            Button:
                text: "Load"
                size_hint_y : 0.5
                background_color:"#34C924"
                on_press: root.load(filechooser.path, filechooser.selection)

<Save_dialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser
            dirselect : True
            path : sys.path.expanduser('~')
        BoxLayout:
            size_hint_y: None
            height : 70
            spacing : 100
            Button:
                text: "Cancel"
                size_hint_y : 0.5
                size_hint_x : 0.3
                background_color:"#F00020"
                on_release: root.cancel()
            TextInput :
                id : save_html
                text : root.text
                size_hint_y : 0.5
                size_hint_x : 0.3
            Button:
                text: "Save graph"
                size_hint_y : 0.5
                size_hint_x : 0.3
                background_color:"#34C924"
                on_press: root.save(filechooser.path, save_html.text)

<Change_tab>:
    FloatLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        Label :
            text : "Changing tab will remove file selection"
            pos_hint : {"center_x" : 0.5, "center_y" : 0.5}

        Button:
            text: "Cancel"
            size_hint_y : 0.1
            background_color:"#F00020"
            on_release: root.cancel()
            pos_hint : {"center_x" : 0.3, "center_y" : 0.4}

        Button:
            text: "OK"
            size_hint_y : 0.1
            background_color:"#34C924"
            on_press: root.proceed()
            pos_hint : {"center_x" : 0.7, "center_y" : 0.4}

<MyPanel>:

    do_default_tab: False
    size:(400,400)
    tab_pos : "top_mid"
    on_current_tab : root.on_tab_change()
    TabbedPanelItem:

        id : Main
        text: "Main"
        font_size:  20
        FloatLayout:
            id : Main

            Label :
                id : files_main
                text : "Currently selected files :\n\nfaa Model :\n\nfaa Subject :\n\nfna :\n\ngff :\n\nsbml :\n\ntsv :"
                pos_hint : {"center_x" : 0.15, "center_y" : 0.6}
                text_size : cm(6), None
                halign: 'center'
                valign: 'middle'
                font_size : 18

            Load_Button:
                id : sbmlMain
                file : "sbml"
                text:"Choose .sbml file"
                pos_hint: {"center_x" : 0.8,"center_y" : 0.6}
                on_press : root.show_load("sbml","sbml",self)
            Load_Button:
                id : faaSMain
                file : "faa Subject"
                text:"Choose .faa subject file"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.6}
                on_press : root.show_load("faaS","faa",self)

            Load_Button:
                id : faaMMain
                file : "faa Model"
                text:"Choose .faa model file "
                pos_hint: {"center_x" : 0.5,"center_y" : 0.8}
                on_press : root.show_load("faaM","faa",self)
            
            
            Load_Button:
                id : fnaMain
                file : "fna"
                text:"Choose .fna file"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.4}
                on_press : root.show_load("fna","fna",self)
            
            Load_Button:
                id : tsvMain
                file : "tsv"
                text:"Choose .tsv file "
                pos_hint: {"center_x" : 0.8,"center_y" : 0.4}
                on_press : root.show_load("tsv","tsv",self)
            
            Load_Button:
                id : gffMain
                file : "gff"
                text:"Choose .gff file "
                pos_hint: {"center_x" : 0.8,"center_y" : 0.8}
                on_press : root.show_load("gff","gff",self)
            
            Button:
                id : btn7
                text:"Run"
                background_color:"#a1d99b"
                pos_hint: {"center_x" : 0.8,"center_y" : 0.15}
                on_press : root.go_module()

            Button:
                id : btn
                background_color:"#CECECE"
                text:"Parameters"
                pos_hint: {"center_x" : 0.2,"center_y" : 0.15}
                on_press : root.show_param()

            Load_Button:
                id : btn
                text:"Set main directory"
                background_color:"#fcbba1"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.15}
                on_press : root.choosedirectory()

    TabbedPanelItem :
        id : BLASTing
        text : "BLASTing"
        font_size :  20

        FloatLayout:
            Label :
                id : files_blast
                text : "Currently selected files :\n\nfaa Model :\n\nfaa Subject :\n\ngff :\n\nsbml :"
                pos_hint : {"center_x" : 0.15, "center_y" : 0.7}
                text_size : cm(6), None
                halign: 'center'
                valign: 'middle'
                font_size : 18

            Load_Button:
                id : sbmlBlast
                file : "sbml"
                text:"Choose .sbml file"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.55}
                on_press : root.show_load("sbml","sbml",self)
            Load_Button:
                id : faaSBlast
                file : "faa Subject"
                text:"Choose .faa subject file"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.8}
                on_press : root.show_load("faaS","faa",self)

            Load_Button:
                id : faaMBlast
                file : "faa Model"
                text:"Choose .faa model file"
                pos_hint: {"center_x" : 0.8,"center_y" : 0.55}
                on_press : root.show_load("faaM","faa",self)
            
            Load_Button:
                id : gffBlast
                file : "gff"
                text:"Choose .gff file"
                pos_hint: {"center_x" : 0.8,"center_y" : 0.8}
                on_press : root.show_load("gff","gff",self)
            
            Button:
                id : btn
                text:"Run "
                background_color:"#a1d99b"
                pos_hint: {"center_x" : 0.2,"center_y" : 0.15}
                on_press : root.go_module()
            Button:
                id : btn
                background_color:"#CECECE"
                text:"Parameters"
                pos_hint: {"center_x" : 0.8,"center_y" : 0.15}
                on_press : root.show_param()

            Button:
                id : btn
                text:"Set main directory"
                background_color:"#fcbba1"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.15}
                on_press : root.choosedirectory()

    TabbedPanelItem :
        id : MPWTing
        text : "MPWTing"
        font_size :  20

        FloatLayout:
            Label :
                id : files_mpwt
                text : "Currently selected files :\n\nfna :\n\ngff :\n\ntsv :"
                pos_hint : {"center_x" : 0.15, "center_y" : 0.7}
                text_size : cm(6), None
                halign: 'center'
                valign: 'middle'
                font_size : 18

            Load_Button:
                id : fnaMpwting
                file : "fna"
                text:"Choose .fna file"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.8}
                on_press : root.show_load("fna","fna",self)
            
            Load_Button:
                id : tsvMpwting
                file : "tsv"
                text:"Choose .tsv file"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.4}
                on_press : root.show_load("tsv","tsv",self)
            
            Load_Button:
                id : gffMpwting
                file : "gff"
                text:"Choose .gff file"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.6}
                on_press : root.show_load("gff","gff", self)
            
            Button:
                id : btn
                text:"Run"
                background_color:"#a1d99b"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                on_press : root.go_module()

    TabbedPanelItem:
        id : Merging
        text: "Merging"
        font_size:  20
        FloatLayout:
            Button:
                id : merge
                text:"Merge files"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.5}
                on_press : root.module_merge()
            Button:
                id : btn 
                size_hint:(0.25,0.10)
                text:"Set main directory with \nBLAST and MPWT results"
                background_color:"#fcbba1"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.7}
                on_press : root.choosedirectory()


    TabbedPanelItem :
        id : Graphs
        text : "Graphs"
        font_size : 20
        id : graph_panel

        GridLayout :
            cols : 4

            FloatLayout :
                size_hint_x : 0.5

                Label :
                    id : keywords
                    text : "Currently in search :\n\nMetabolites :\n\nReactions:\n\nCompartment:\n"
                    text_size : cm(4), None
                    size_hint_y : 0.3
                    font_size : 16
                    valign : "middle"
                    haligne : "center"
                    pos_hint : {"center_x" : 0.25, "center_y" : 0.7}

                Label :
                    id : physics_options
                    font_size : 16
                    text : "Physics mode selected : \n\n               Default"
                    pos_hint: {"center_x" : 0.25,"center_y" : 0.5}

                Label :
                    id : cofactors_selection
                    text : "Cofactors displayed : No"
                    font_size : 16
                    pos_hint: {"center_x" : 0.25,"center_y" : 0.4}

                Button :
                    text : "Load file"
                    size_hint : None,None
                    width : 175
                    height : 70
                    file : "json"
                    on_release : root.show_load("json","json", self)
                    pos_hint: {"center_x" : 0.75,"center_y" : 0.8}

                Compartment_List :
                    pos_hint : {"center_x" : 0.25, "center_y" : 0.27}
                    id : compartment_list
                    opacity : 0
                    size_hint : None, 0.36
                    width : 175


                Button :
                    id : open_cpt_list
                    size_hint : None, None
                    width : 175
                    height : 60
                    text : "Choose compartment"
                    text_size : self.size
                    on_release : root.toggle_compartment_list()
                    valign : "middle"
                    halign : "center"
                    pos_hint: {"center_x" : 0.25,"center_y" : 0.05}

                Button :
                    id : physics_selection
                    size_hint : None, None
                    width : 175
                    height : 70
                    text : "Physics Selection"
                    text_size : self.size
                    font_size : 20
                    valign : "middle"
                    halign : "center"
                    on_release : root.select_options()
                    pos_hint: {"center_x" : 0.25,"center_y" : 0.9}

                Button :
                    type : "html"
                    text : "Draw Graph"
                    on_release : root.pop_up_html(self)
                    size_hint : None, None
                    width : 175
                    height : 70
                    text_size : self.size
                    halign : "center"
                    valign : "middle"
                    pos_hint: {"center_x" : 0.75,"center_y" : 0.6}

                Button :
                    type : "json"
                    text : "Save json"
                    on_release : root.pop_up_html(self)
                    size_hint : None, None
                    width : 175
                    height : 70
                    text_size : self.size
                    halign : "center"
                    valign : "middle"
                    pos_hint: {"center_x" : 0.75,"center_y" : 0.4}

                Button :
                    text : "Clear data"
                    size_hint : None, None
                    width : 175
                    height : 70
                    on_release : root.clear_graph_data()
                    pos_hint: {"center_x" : 0.75,"center_y" : 0.2}
            BoxLayout :
                size_hint_x : 0.005
                canvas:
                    Color:
                        rgb: 0, 0, 0
                    Rectangle:
                        size: self.size
                        pos : self.pos
            BoxLayout:
                orientation : "vertical"
                size_hint_x : 0.3

                Button :
                    size_hint_x : 1
                    text : "hide/show metabolites list"
                    on_release : root.toggle_meta_list()

                Label :
                    size_hint_y : None
                    height : 80

                Meta_List :
                    opacity : 0
                    id : Meta_list

                TI_meta :
                    id : TI_meta
                    text : ""
                    size_hint_y : None
                    height : 50
                    size_hint_x : 1

            BoxLayout:
                orientation : "vertical"
                size_hint_x : 0.3

                Button :
                    size_hint_x : 1
                    text : "hide/show reaction list"
                    on_release : root.toggle_reac_list()

                Label :
                    size_hint_y : None
                    height : 80

                Reac_List :
                    opacity : 0
                    id : Reac_list

                TI_reac :
                    id : TI_reac
                    multiline : False
                    size_hint_y : None
                    height : 50
                    size_hint_x : 1



<Meta_list_buttons>:
    halign: "center"
    valign: "center"
    font_size: 20
    size_hint_y: None
    text_size : self.size
    height: self.texture_size[1]

<Reac_list_buttons>:
    halign: "center"
    valign: "center"
    font_size: 20
    size_hint_y: None
    text_size : self.size
    height: self.texture_size[1]

<Compartment_buttons>:
    halign: "center"
    valign: "center"
    font_size: 20
    size_hint_y: None
    text_size : self.size
    height: self.texture_size[1]

<Meta_List>:
    viewclass : "Meta_list_buttons"
    RecycleBoxLayout :
        default_size : None, 50
        default_size_hint : 1, None
        size_hint_y : None
        height : self.minimum_height
        orientation : "vertical"

<Reac_List>:
    viewclass : "Reac_list_buttons"
    RecycleBoxLayout :
        default_size : None, 50
        default_size_hint : 1, None
        size_hint_y : None
        height : self.minimum_height
        orientation : "vertical"

<Compartment_List>:
    viewclass : "Compartment_buttons"
    RecycleBoxLayout :
        default_size : None, 50
        default_size_hint : 1, None
        size_hint_y : None
        height : self.minimum_height
        orientation : "vertical"


<TI_meta>:
    id : TI_meta
    size_hint : 0.3,0.3
    pos_hint : {"center_x" : 0.5, "top" : 1}

<TI_reac>:
    id : TI_react
    size_hint : 0.3,0.3
    pos_hint : {"center_x" : 0.5, "top" : 1}


<Button>:
    size_hint: 0.27,0.12
    font_size: 20
    color: 1,1,1
    background_color: "#E11E1E"


<Parameters>:
    BoxLayout:
        orientation:"vertical"
        size: root.size
        pos: root.pos
        BoxLayout:
            orientation:"vertical"
            size_hint: (1,0.8)
            Label:
                font_size : 20
                text : "Don't forget to press enter to save each parameter "
                color:"#F00020"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.1}
                size_hint: (0.1,0.1)
            Label:
                text : "blast's identity percentage tolerated ([0-100])"

                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            TextInput:
                id: input1
                multiline : False
                on_text_validate : root.add_value("i","input1")
                text : ""
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            Label:
                text : "tolerated length difference between the two aligned sequences([0-100])"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            TextInput:
                id:input2
                multiline : False
                on_text_validate : root.add_value("d","input2")
                text : ""
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            Label:
                text : "blast's e-value threshold value([0-1])"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            TextInput:
                id:input3
                multiline : False
                on_text_validate : root.add_value("ev","input3")
                text : ""
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            Label:
                text : "minimum sequence coverage tolerated([0-100])"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            TextInput:
                id:input4
                multiline : False
                text : ""
                on_text_validate : root.add_value("c","input4")
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            Label:
                text : "blast's bit-score threshold value ([0-1000])"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            TextInput:
                id:input5
                multiline : False
                on_text_validate : root.add_value("bs","input5")
                text : ""
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            Label:
                text : "output draft name"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            TextInput:
                id:input6
                multiline : False
                on_text_validate : root.add_value("nom","input6")
                text : ""
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
        FloatLayout:
            size_hint: (1,0.2)
            Button:
                text : "Return"
                on_release : root.cancel()
                background_color:"#fcbba1"
                pos_hint: {"center_x" : 0.3,"center_y" : 0.3}
                size_hint: (0.3,0.4)
            Button:
                text : "Reset"
                on_press : root.reset()
                on_press : root.cancel()
                background_color:"#fcbba1"
                pos_hint: {"center_x" : 0.7,"center_y" : 0.3}
                size_hint: (0.3,0.4)

<DirectoryName>:
    BoxLayout:
        orientation:"vertical"
        size: root.size
        pos: root.pos
        BoxLayout:
            orientation:"vertical"
            size_hint: (1,1)
            Label:
                text : "Enter directory file"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
                size_hint: (0.1,0.1)
            TextInput:
                id:inputdirec
                multiline : False
                text : ""
                pos_hint: {"center_x" : 0.5,"center_y" : 0.5}
                size_hint: (0.4,0.1)
        FloatLayout:
            size_hint: (1,0.3)
            Button:
                text : "Validate"
                on_press:root.add_directory("inputdirec")
                on_release : root.cancel()
                background_color:"#fcbba1"
                pos_hint: {"center_x" : 0.5,"center_y" : 0.5}
                size_hint: (0.3,0.4)

<Physics>:
    Label :
        text: "Cofactors settings"
        id : cofac_settings
        font_size : 20
        pos_hint: {"center_x" : 0.5,"center_y" : 0.75}

    ToggleButton :
        id : yes_cofac
        type : "Yes"
        group : "Cofactors"
        text : "With cofactors"
        pos_hint: {"center_x" : 0.3,"center_y" : 0.6}
        on_release : root.select(self)

    ToggleButton :
        id : no_cofac
        type : "No"
        group : "Cofactors"
        text : "Without cofactors"
        pos_hint: {"center_x" : 0.7,"center_y" : 0.6}
        on_release : root.select(self)


    Label :
        text : "Physics settings"
        id : physics_selection
        font_size : 20
        pos_hint: {"center_x" : 0.5,"center_y" : 0.35}

    ToggleButton :
        id : default
        type : "default"
        group : "Physics"
        text : "Default value"
        pos_hint: {"center_x" : 0.2,"center_y" : 0.2}
        on_release : root.select(self)

    ToggleButton :
        id : option_select
        group : "Physics"
        type : "dynamic"
        text : "Buttons selection"
        pos_hint: {"center_x" : 0.5,"center_y" : 0.2}
        on_release : root.select(self)

    ToggleButton :
        id : no_physics
        type : "no_physics"
        group : "Physics"
        pos_hint: {"center_x" : 0.8,"center_y" : 0.2}
        text : "No physics"
        on_release : root.select(self)







